{"version":3,"sources":["scripts/app-aae9fb228d.js"],"names":["angular","module","heatfilter","_","require","scope","link","elm","attrs","ctrl","$validators","modelValue","$isEmpty","uniq","pluck","length","$inject","directive","csvReader","CSV","restrict","element","ngModel","read","reader","FileReader","file","get","files","onload","csv","result","header","$setViewValue","parse","readAsText","updateValidity","$setValidity","val","on","$evalAsync","MainController","$log","leafletData","L","csvChanged","vm","Object","keys","csvRows","latitudeColumn","longitudeColumn","filterByColumn","filterOptions","filterOptionsSelected","renderHeatmap","form","$valid","filteredRows","filter","row","contains","_renderHeatmap","rows","getMap","then","map","heatmap","removeLayer","TileLayer","WebGLHeatMap","heatmapOptions","forEach","point","parseRow","addDataPoint","apply","addLayer","filterByColumnChanged","column","sort","copy","pointIntensity","isFilterSelected","value","toggleFilterSelected","without","push","setFilterSelected","filters","fitBounds","bounds","this","center","lat","lng","zoom","defaults","layers","baselayers","googleRoadmap","name","layerType","type","size","autoresize","controller","runBlock","debug","run","routerConfig","$stateProvider","$urlRouterProvider","state","url","templateUrl","controllerAs","otherwise","config","constant","moment","$logProvider","toastrConfig","debugEnabled","allowHtml","timeOut","positionClass","preventDuplicates","progressBar","$templateCache","put"],"mappings":"CAAA,WACE,YAEAA,SACGC,OAAO,gBAAiB,YAAa,YAAa,UAAW,aAAc,aAAc,YAAa,eAAgB,SAAU,kBAOrI,WACE,YAMA,SAASC,GAAWC,GAClB,OACEC,QAAS,UACTC,OACEH,WAAY,KAEdI,KAAM,SAAUD,EAAOE,EAAKC,EAAOC,GACjCA,EAAKC,YAAYR,WAAa,SAAUS,GACtC,MAAIF,GAAKG,SAASD,IACT,EAGFR,EAAEU,KAAKV,EAAEW,MAAMT,EAAMH,WAAYS,IAAaI,QAAU,OAhBvEb,EAAWc,SAAW,KAAtBhB,QAAQC,OAAO,gBACZgB,UAAU,aAAcf,MAwB7B,WACE,YAMA,SAASgB,GAAUC,GAEjB,OACEC,SAAU,IACVhB,QAAS,WACTE,KAAM,SAAUD,EAAOgB,EAASb,EAAOc,GASrC,QAASC,KACP,GAAIC,GAAS,GAAIC,YACbC,EAAOL,EAAQM,IAAI,GAAGC,MAAM,EAEhCJ,GAAOK,OAAS,WACd,GAAIC,GAAM,GAAIX,GAAIK,EAAOO,QAASC,QAAQ,GAC1CV,GAAQW,cAAcH,EAAII,UAG5BV,EAAOW,WAAWT,GAGpB,QAASU,KACPd,EAAQe,aAAa,WAA6B,IAAjBhB,EAAQiB,OArBtChB,IACLc,IAEAf,EAAQkB,GAAG,SAAU,WACnBH,IACA/B,EAAMmC,WAAWjB,QAdzBL,EAAUF,SAAW,OADrBhB,QAAQC,OAAO,gBACZgB,UAAU,YAAaC,MAyC5B,WACE,YAOA,SAASuB,GAAeC,EAAMC,EAAaC,EAAGzC,GAiD5C,QAAS0C,KACPC,EAAGd,OAASe,OAAOC,KAAKF,EAAGG,QAAQ,IAEnCH,EAAGI,eAAiB,KACpBJ,EAAGK,gBAAkB,KACrBL,EAAGM,eAAiB,KACpBN,EAAGO,cAAgB,KACnBP,EAAGQ,sBAAwB,KAG7B,QAASC,GAAcC,GACrB,GAAKA,EAAKC,OAIV,GAAiC,OAA7BX,EAAGQ,sBAAgC,CACrC,GAAII,GAAeZ,EAAGG,QAAQU,OAAO,SAAUC,GAC7C,MAAOzD,GAAE0D,SAASf,EAAGQ,sBAAuBM,EAAId,EAAGM,kBAGrDU,GAAeJ,OAEfI,GAAehB,EAAGG,SAItB,QAASa,GAAgBC,GACvBpB,EAAYqB,SAASC,KAAK,SAAUC,GAG9BC,GACFD,EAAIE,YAAYD,GAElBA,EAAU,GAAIvB,GAAEyB,UAAUC,aAAaxB,EAAGyB,gBAE1CR,EAAKS,QAAQ,SAAUZ,GACrB,GAAIa,GAAQC,EAASd,EACrBO,GAAQQ,aAAaC,MAAMT,EAASM,KAGtCP,EAAIW,SAASV,KAIjB,QAASW,GAAsBC,GACzBjC,EAAGM,gBAAkB2B,EAAOtB,SAC9BX,EAAGO,cAAgBlD,EAAEU,KAAKV,EAAEW,MAAMgC,EAAGG,QAASH,EAAGM,iBAAiB4B,OAClElC,EAAGQ,sBAAwBtD,QAAQiF,KAAKnC,EAAGO,gBAQ/C,QAASqB,GAASd,GAChB,OAAQA,EAAId,EAAGI,gBAAiBU,EAAId,EAAGK,iBAAkBL,EAAGoC,gBAG9D,QAASC,GAAiBC,GACxB,MAAOjF,GAAE0D,SAASf,EAAGQ,sBAAuB8B,GAG9C,QAASC,GAAqBD,GACxBjF,EAAE0D,SAASf,EAAGQ,sBAAuB8B,GACvCtC,EAAGQ,sBAAwBnD,EAAEmF,QAAQxC,EAAGQ,sBAAuB8B,GAE/DtC,EAAGQ,sBAAsBiC,KAAKH,GAIlC,QAASI,GAAkBC,GACzB3C,EAAGQ,sBAAwBtD,QAAQiF,KAAKQ,GAG1C,QAASC,KAEP,GAAK5C,EAAGI,gBAAmBJ,EAAGK,gBAA9B,CAIA,GAAIwC,KACJ7C,GAAGG,QAAQuB,QAAQ,SAAUZ,GAC3B,GAAIa,GAAQC,EAASd,EACrB+B,GAAOJ,MAAMd,EAAM,GAAIA,EAAM,OAE/B9B,EAAYqB,SAASC,KAAK,SAAUC,GAClCA,EAAIwB,UAAUC,MAvIlB,GAAI7C,GAAK8C,IAET9C,GAAGG,WACHH,EAAGoC,eAAiB,EACpBpC,EAAGd,UACHc,EAAGI,eAAiB,KACpBJ,EAAGK,gBAAkB,KACrBL,EAAGM,eAAiB,KACpBN,EAAGO,cAAgB,KACnBP,EAAGQ,sBAAwB,KAE3BR,EAAGD,WAAaA,EAChBC,EAAGgC,sBAAwBA,EAC3BhC,EAAGS,cAAgBA,EACnBT,EAAGqC,iBAAmBA,EACtBrC,EAAGuC,qBAAuBA,EAC1BvC,EAAG0C,kBAAoBA,EACvB1C,EAAG4C,UAAYA,EAEf5C,EAAGoB,KACD2B,QACEC,IAAK,WACLC,KAAM,QACNC,KAAM,IAERC,YACAC,QACEC,YACEC,eACEC,KAAM,iBACNC,UAAW,UACXC,KAAM,aAMdzD,EAAGyB,gBACDiC,KAAM,IACNC,YAAY,EAId,IAAItC,GA/CN1B,EAAezB,SAAW,OAAQ,cAAe,IAAK,KAFtDhB,QACGC,OAAO,gBACPyG,WAAW,iBAAkBjE,MAiJlC,WACE,YAOA,SAASkE,GAASjE,GAEhBA,EAAKkE,MAAM,gBAJbD,EAAS3F,SAAW,QAHpBhB,QACGC,OAAO,gBACP4G,IAAIF,MAUT,WACE,YAOA,SAASG,GAAaC,EAAgBC,GACpCD,EACGE,MAAM,QACLC,IAAK,IACLC,YAAa,qBACbT,WAAY,iBACZU,aAAc,SAGlBJ,EAAmBK,UAAU,KAV/BP,EAAa9F,SAAW,iBAAkB,sBAJ1ChB,QACGC,OAAO,gBACPqH,OAAOR,MAkBZ,WACE,YAEA9G,SACGC,OAAO,gBACPsH,SAAS,MAAOpG,KAChBoG,SAAS,IAAK3E,GACd2E,SAAS,IAAKpH,GACdoH,SAAS,SAAUC,WAIxB,WACE,YAOA,SAASF,GAAOG,EAAcC,GAE5BD,EAAaE,cAAa,GAG1BD,EAAaE,WAAY,EACzBF,EAAaG,QAAU,IACvBH,EAAaI,cAAgB,kBAC7BJ,EAAaK,mBAAoB,EACjCL,EAAaM,aAAc,EAT7BV,EAAOtG,SAAW,eAAgB,gBALlChB,QACGC,OAAO,gBACPqH,OAAOA,MAiBZtH,QAAQC,OAAO,gBAAgB4G,KAAK,iBAAkB,SAASoB,GAAiBA,EAAeC,IAAI,qBAAqB,wiHACxHD,EAAeC,IAAI,4CAA4C","file":"scripts/app-aae9fb228d.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap', ['ngAnimate', 'ngCookies', 'ngTouch', 'ngSanitize', 'ngMessages', 'ui.router', 'ui.bootstrap', 'toastr', 'ui-leaflet']);\n\n})();\n\n/**\n * Attribute directive for the file input. Parse selected csv file and update model value with the result.\n */\n(function () {\n  'use strict';\n\n  angular.module('csvToHeatmap')\n    .directive('heatfilter', heatfilter);\n\n  /** @ngInject */\n  function heatfilter(_) {\n    return {\n      require: 'ngModel',\n      scope: {\n        heatfilter: '='\n      },\n      link: function (scope, elm, attrs, ctrl) {\n        ctrl.$validators.heatfilter = function (modelValue) {\n          if (ctrl.$isEmpty(modelValue)) {\n            return true;\n          }\n\n          return _.uniq(_.pluck(scope.heatfilter, modelValue)).length <= 500;\n        };\n      }\n    };\n  }\n})();\n/**\n * Attribute directive for the file input. Parse selected csv file and update model value with the result.\n */\n(function () {\n  'use strict';\n\n  angular.module('csvToHeatmap')\n    .directive('csvReader', csvReader);\n\n  /** @ngInject */\n  function csvReader(CSV) {\n\n    return {\n      restrict: 'A',\n      require: '?ngModel',\n      link: function (scope, element, attrs, ngModel) {\n        if (!ngModel) return;\n        updateValidity();\n\n        element.on('change', function () {\n          updateValidity();\n          scope.$evalAsync(read);\n        });\n\n        function read() {\n          var reader = new FileReader();\n          var file = element.get(0).files[0];\n\n          reader.onload = function () {\n            var csv = new CSV(reader.result, {header: true});\n            ngModel.$setViewValue(csv.parse());\n          };\n\n          reader.readAsText(file);\n        }\n\n        function updateValidity() {\n          ngModel.$setValidity('required', element.val() != '');\n        }\n      }\n    };\n\n  }\n})();\n/**\n * @name Main\n * @type MainController\n */\n(function () {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController($log, leafletData, L, _) {\n    var vm = this;\n\n    vm.csvRows = [];\n    vm.pointIntensity = 8;\n    vm.header = [];\n    vm.latitudeColumn = null;\n    vm.longitudeColumn = null;\n    vm.filterByColumn = null;\n    vm.filterOptions = null;\n    vm.filterOptionsSelected = null;\n\n    vm.csvChanged = csvChanged;\n    vm.filterByColumnChanged = filterByColumnChanged;\n    vm.renderHeatmap = renderHeatmap;\n    vm.isFilterSelected = isFilterSelected;\n    vm.toggleFilterSelected = toggleFilterSelected;\n    vm.setFilterSelected = setFilterSelected;\n    vm.fitBounds = fitBounds;\n\n    vm.map = {\n      center: {\n        lat: 51.4768219,\n        lng: -0.0006172,\n        zoom: 14\n      },\n      defaults: {},\n      layers: {\n        baselayers: {\n          googleRoadmap: {\n            name: 'Google Streets',\n            layerType: 'ROADMAP',\n            type: 'google'\n          }\n        }\n      }\n    };\n\n    vm.heatmapOptions = {\n      size: 750,\n      autoresize: true\n    };\n\n\n    var heatmap;\n\n    /**\n     * Listen to csv changed, update header columns and reset file related options\n     */\n    function csvChanged() {\n      vm.header = Object.keys(vm.csvRows[0]);\n\n      vm.latitudeColumn = null;\n      vm.longitudeColumn = null;\n      vm.filterByColumn = null;\n      vm.filterOptions = null;\n      vm.filterOptionsSelected = null;\n    }\n\n    function renderHeatmap(form) {\n      if (!form.$valid) {\n        return;\n      }\n\n      if (vm.filterOptionsSelected !== null) {\n        var filteredRows = vm.csvRows.filter(function (row) {\n          return _.contains(vm.filterOptionsSelected, row[vm.filterByColumn]);\n        });\n\n        _renderHeatmap(filteredRows);\n      } else {\n        _renderHeatmap(vm.csvRows);\n      }\n    }\n\n    function _renderHeatmap (rows) {\n      leafletData.getMap().then(function (map) {\n\n        // Recreate heatmap\n        if (heatmap) {\n          map.removeLayer(heatmap);\n        }\n        heatmap = new L.TileLayer.WebGLHeatMap(vm.heatmapOptions);\n\n        rows.forEach(function (row) {\n          var point = parseRow(row);\n          heatmap.addDataPoint.apply(heatmap, point);\n        });\n\n        map.addLayer(heatmap);\n      });\n    }\n\n    function filterByColumnChanged(column) {\n      if (vm.filterByColumn && column.$valid) {\n        vm.filterOptions = _.uniq(_.pluck(vm.csvRows, vm.filterByColumn)).sort();\n        vm.filterOptionsSelected = angular.copy(vm.filterOptions);\n      }\n    }\n\n    /**\n     * @param row\n     * @returns {*[]}\n     */\n    function parseRow(row) {\n      return [row[vm.latitudeColumn], row[vm.longitudeColumn], vm.pointIntensity];\n    }\n\n    function isFilterSelected(value) {\n      return _.contains(vm.filterOptionsSelected, value);\n    }\n\n    function toggleFilterSelected(value) {\n      if (_.contains(vm.filterOptionsSelected, value)) {\n        vm.filterOptionsSelected = _.without(vm.filterOptionsSelected, value);\n      } else {\n        vm.filterOptionsSelected.push(value);\n      }\n    }\n\n    function setFilterSelected(filters) {\n      vm.filterOptionsSelected = angular.copy(filters);\n    }\n\n    function fitBounds() {\n\n      if (!vm.latitudeColumn || !vm.longitudeColumn) {\n        return;\n      }\n\n      var bounds = [];\n      vm.csvRows.forEach(function (row) {\n        var point = parseRow(row);\n        bounds.push([point[0], point[1]]);\n      });\n      leafletData.getMap().then(function (map) {\n        map.fitBounds(bounds);\n      });\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('home', {\n        url: '/',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'Main'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global moment:false, CSV:false, L:false, _:false */\n(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .constant('CSV', CSV)\n    .constant('L', L)\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, toastrConfig) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    // Set options third-party lib\n    toastrConfig.allowHtml = true;\n    toastrConfig.timeOut = 3000;\n    toastrConfig.positionClass = 'toast-top-right';\n    toastrConfig.preventDuplicates = false;\n    toastrConfig.progressBar = false;\n  }\n\n})();\n\nangular.module(\"csvToHeatmap\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/main.html\",\"<div class=\\\"row\\\"><div class=\\\"col-md-8\\\" style=\\\"margin-bottom: 2em;\\\"><leaflet defaults=\\\"Main.map.defaults\\\" layers=\\\"Main.map.layers\\\" lf-center=\\\"Main.map.center\\\" height=\\\"400px\\\" width=\\\"100%\\\"></leaflet><div ng-if=\\\"Main.filterByColumn\\\" style=\\\"margin: 1em 0;\\\"><a class=\\\"btn btn-default btn-sm\\\" ng-click=\\\"Main.setFilterSelected(Main.filterOptions)\\\">Select all</a> <a class=\\\"btn btn-default btn-sm\\\" ng-click=\\\"Main.setFilterSelected([])\\\">Select none</a></div><table class=\\\"table table-condensed table-hover\\\" ng-if=\\\"Main.filterByColumn\\\"><tbody><tr ng-repeat=\\\"filterValue in Main.filterOptions\\\" ng-click=\\\"Main.toggleFilterSelected(filterValue)\\\" style=\\\"cursor: pointer\\\" class=\\\"no-text-select\\\"><td style=\\\"width: 1%\\\"><i class=\\\"glyphicon glyphicon-unchecked\\\" ng-show=\\\"!Main.isFilterSelected(filterValue)\\\"></i> <i class=\\\"glyphicon glyphicon-check\\\" ng-show=\\\"Main.isFilterSelected(filterValue)\\\"></i></td><td>{{ ::filterValue }}</td><td></td></tr></tbody></table></div><div class=\\\"col-md-4\\\" style=\\\"margin-bottom: 2em;\\\"><form name=\\\"csvForm\\\" ng-submit=\\\"Main.renderHeatmap(csvForm)\\\"><div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': csvForm.$submitted && csvForm.csv.$invalid}\\\"><label class=\\\"control-label\\\" for=\\\"csv\\\">CSV File</label> <input ng-model=\\\"Main.csvRows\\\" type=\\\"file\\\" name=\\\"csv\\\" ng-change=\\\"Main.csvChanged()\\\" csv-reader=\\\"\\\" id=\\\"csv\\\"><div ng-messages=\\\"csvForm.csv.$error\\\" ng-show=\\\"csvForm.$submitted\\\"><div ng-messages-include=\\\"error-messages\\\"></div></div></div><div class=\\\"form-group\\\"><label class=\\\"control-label\\\" for=\\\"intensity\\\">Point intensity (%)</label> <input type=\\\"number\\\" name=\\\"intensity\\\" min=\\\"0\\\" max=\\\"100\\\" ng-model=\\\"Main.pointIntensity\\\" class=\\\"form-control\\\" id=\\\"intensity\\\"></div><div class=\\\"form-group\\\"><label class=\\\"control-label\\\" for=\\\"radius\\\">Point radius (meters)</label> <input name=\\\"radius\\\" type=\\\"number\\\" min=\\\"0\\\" max=\\\"10000\\\" ng-model=\\\"Main.heatmapOptions.size\\\" class=\\\"form-control\\\" id=\\\"radius\\\"></div><div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': csvForm.$submitted && csvForm.latitudeColumn.$invalid}\\\"><label class=\\\"control-label\\\" for=\\\"latitudeColumn\\\">Latitude column</label><select name=\\\"latitudeColumn\\\" class=\\\"form-control\\\" ng-model=\\\"Main.latitudeColumn\\\" required=\\\"\\\" id=\\\"latitudeColumn\\\" ng-change=\\\"Main.fitBounds()\\\"><option ng-repeat=\\\"headerName in Main.header\\\">{{ headerName }}</option></select><div ng-messages=\\\"csvForm.latitudeColumn.$error\\\" ng-show=\\\"csvForm.$submitted\\\"><div ng-messages-include=\\\"error-messages\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': csvForm.$submitted && csvForm.longitudeColumn.$invalid}\\\"><label class=\\\"control-label\\\" for=\\\"longitudeColumn\\\">Longitude column</label><select name=\\\"longitudeColumn\\\" class=\\\"form-control\\\" ng-model=\\\"Main.longitudeColumn\\\" required=\\\"\\\" id=\\\"longitudeColumn\\\" ng-change=\\\"Main.fitBounds()\\\"><option ng-repeat=\\\"headerName in Main.header\\\">{{ headerName }}</option></select><div ng-messages=\\\"csvForm.longitudeColumn.$error\\\" ng-show=\\\"csvForm.$submitted\\\"><div ng-messages-include=\\\"error-messages\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': csvForm.filterByColumn.$invalid}\\\"><label class=\\\"control-label\\\" for=\\\"filterByColumn\\\">Filter by column (optional)</label><select name=\\\"filterByColumn\\\" class=\\\"form-control\\\" ng-model=\\\"Main.filterByColumn\\\" id=\\\"filterByColumn\\\" ng-change=\\\"Main.filterByColumnChanged(csvForm.filterByColumn)\\\" heatfilter=\\\"Main.csvRows\\\"><option ng-repeat=\\\"headerName in Main.header\\\">{{ headerName }}</option></select><div ng-messages=\\\"csvForm.filterByColumn.$error\\\"><div ng-messages-include=\\\"error-messages\\\"></div></div></div><button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Render heatmap</button></form></div></div>\");\n$templateCache.put(\"app/components/csv-reader/csv-reader.html\",\"<input type=\\\"file\\\" name=\\\"csv\\\">\");}]);"],"sourceRoot":"/source/"}