{"version":3,"sources":["scripts/app-5ed43cae72.js"],"names":["angular","module","csvReader","CSV","restrict","require","link","scope","element","attrs","ngModel","read","reader","FileReader","file","get","files","onload","csv","result","header","$setViewValue","parse","readAsText","updateValidity","$setValidity","val","on","$evalAsync","$inject","directive","MainController","$log","leafletData","L","_","csvChanged","vm","Object","keys","csvRows","latitudeColumn","longitudeColumn","filterByColumn","filterOptions","filterOptionsSelected","renderHeatmap","form","$valid","filteredRows","filter","row","contains","_renderHeatmap","rows","getMap","then","map","heatmap","removeLayer","TileLayer","WebGLHeatMap","heatmapOptions","forEach","point","parseRow","addDataPoint","apply","addLayer","filterByColumnChanged","uniq","pluck","sort","copy","pointIntensity","isFilterSelected","value","toggleFilterSelected","without","push","setFilterSelected","filters","this","center","lat","lng","zoom","defaults","layers","baselayers","googleRoadmap","name","layerType","type","size","autoresize","controller","runBlock","debug","run","routerConfig","$stateProvider","$urlRouterProvider","state","url","templateUrl","controllerAs","otherwise","config","constant","moment","$logProvider","toastrConfig","debugEnabled","allowHtml","timeOut","positionClass","preventDuplicates","progressBar","$templateCache","put"],"mappings":"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","file":"scripts/app-5ed43cae72.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap', ['ngAnimate', 'ngCookies', 'ngTouch', 'ngSanitize', 'ngMessages', 'ui.router', 'ui.bootstrap', 'toastr', 'ui-leaflet']);\n\n})();\n\n/**\n * Attribute directive for the file input. Parse selected csv file and update model value with the result.\n */\n(function () {\n  'use strict';\n\n  angular.module('csvToHeatmap')\n    .directive('csvReader', csvReader);\n\n  /** @ngInject */\n  function csvReader(CSV) {\n\n    return {\n      restrict: 'A',\n      require: '?ngModel',\n      link: function (scope, element, attrs, ngModel) {\n        if (!ngModel) return;\n        updateValidity();\n\n        element.on('change', function () {\n          updateValidity();\n          scope.$evalAsync(read);\n        });\n\n        function read() {\n          var reader = new FileReader();\n          var file = element.get(0).files[0];\n\n          reader.onload = function () {\n            var csv = new CSV(reader.result, {header: true});\n            ngModel.$setViewValue(csv.parse());\n          };\n\n          reader.readAsText(file);\n        }\n\n        function updateValidity() {\n          ngModel.$setValidity('required', element.val() != '');\n        }\n      }\n    };\n\n  }\n})();\n/**\n * @name Main\n * @type MainController\n */\n(function () {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController($log, leafletData, L, _) {\n    var vm = this;\n\n    vm.csvRows = [];\n    vm.pointIntensity = 8;\n    vm.header = [];\n    vm.latitudeColumn = null;\n    vm.longitudeColumn = null;\n    vm.filterByColumn = null;\n    vm.filterOptions = null;\n    vm.filterOptionsSelected = null;\n\n    vm.csvChanged = csvChanged;\n    vm.filterByColumnChanged = filterByColumnChanged;\n    vm.renderHeatmap = renderHeatmap;\n    vm.isFilterSelected = isFilterSelected;\n    vm.toggleFilterSelected = toggleFilterSelected;\n    vm.setFilterSelected = setFilterSelected;\n\n    vm.map = {\n      center: {\n        lat: 42.34,\n        lng: -71.1,\n        zoom: 11\n      },\n      defaults: {},\n      layers: {\n        baselayers: {\n          googleRoadmap: {\n            name: 'Google Streets',\n            layerType: 'ROADMAP',\n            type: 'google'\n          }\n        }\n      }\n    };\n\n    vm.heatmapOptions = {\n      size: 750,\n      autoresize: true\n    };\n\n\n    var heatmap;\n\n    /**\n     * Listen to csv changed, update header columns and reset file related options\n     */\n    function csvChanged() {\n      vm.header = Object.keys(vm.csvRows[0]);\n\n\n      vm.latitudeColumn = null;\n      vm.longitudeColumn = null;\n      vm.filterByColumn = null;\n      vm.filterOptions = null;\n      vm.filterOptionsSelected = null;\n    }\n\n    function renderHeatmap(form) {\n      if (!form.$valid) {\n        return;\n      }\n\n      if (vm.filterOptionsSelected !== null) {\n        var filteredRows = vm.csvRows.filter(function (row) {\n          return _.contains(vm.filterOptionsSelected, row[vm.filterByColumn]);\n        });\n\n        _renderHeatmap(filteredRows);\n      } else {\n        _renderHeatmap(vm.csvRows);\n      }\n    }\n\n    function _renderHeatmap (rows) {\n      leafletData.getMap().then(function (map) {\n\n        // Recreate heatmap\n        if (heatmap) {\n          map.removeLayer(heatmap);\n        }\n        heatmap = new L.TileLayer.WebGLHeatMap(vm.heatmapOptions);\n\n        rows.forEach(function (row) {\n          var point = parseRow(row);\n          heatmap.addDataPoint.apply(heatmap, point);\n        });\n\n        map.addLayer(heatmap);\n      });\n    }\n\n    function filterByColumnChanged() {\n      if (vm.filterByColumn) {\n        vm.filterOptions = _.uniq(_.pluck(vm.csvRows, vm.filterByColumn)).sort();\n        vm.filterOptionsSelected = angular.copy(vm.filterOptions);\n      }\n    }\n\n    /**\n     * @param row\n     * @returns {*[]}\n     */\n    function parseRow(row) {\n      return [row[vm.latitudeColumn], row[vm.longitudeColumn], vm.pointIntensity];\n    }\n\n    function isFilterSelected(value) {\n      return _.contains(vm.filterOptionsSelected, value);\n    }\n\n    function toggleFilterSelected(value) {\n      if (_.contains(vm.filterOptionsSelected, value)) {\n        vm.filterOptionsSelected = _.without(vm.filterOptionsSelected, value);\n      } else {\n        vm.filterOptionsSelected.push(value);\n      }\n    }\n\n    function setFilterSelected(filters) {\n      vm.filterOptionsSelected = angular.copy(filters);\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('home', {\n        url: '/',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'Main'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global moment:false, CSV:false, L:false, _:false */\n(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .constant('CSV', CSV)\n    .constant('L', L)\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('csvToHeatmap')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, toastrConfig) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    // Set options third-party lib\n    toastrConfig.allowHtml = true;\n    toastrConfig.timeOut = 3000;\n    toastrConfig.positionClass = 'toast-top-right';\n    toastrConfig.preventDuplicates = false;\n    toastrConfig.progressBar = false;\n  }\n\n})();\n\nangular.module(\"csvToHeatmap\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/main.html\",\"<div class=\\\"row\\\"><div class=\\\"col-md-8\\\" style=\\\"margin-bottom: 2em;\\\"><leaflet defaults=\\\"Main.map.defaults\\\" layers=\\\"Main.map.layers\\\" lf-center=\\\"Main.map.center\\\" height=\\\"400px\\\" width=\\\"100%\\\"></leaflet><div ng-if=\\\"Main.filterByColumn\\\" style=\\\"margin: 1em 0;\\\"><a class=\\\"btn btn-default btn-sm\\\" ng-click=\\\"Main.setFilterSelected(Main.filterOptions)\\\">Select all</a> <a class=\\\"btn btn-default btn-sm\\\" ng-click=\\\"Main.setFilterSelected([])\\\">Select none</a></div><table class=\\\"table table-condensed table-hover\\\" ng-if=\\\"Main.filterByColumn\\\"><tbody><tr ng-repeat=\\\"filterValue in Main.filterOptions\\\" ng-click=\\\"Main.toggleFilterSelected(filterValue)\\\" style=\\\"cursor: pointer\\\" class=\\\"no-text-select\\\"><td style=\\\"width: 1%\\\"><i class=\\\"glyphicon glyphicon-unchecked\\\" ng-show=\\\"!Main.isFilterSelected(filterValue)\\\"></i> <i class=\\\"glyphicon glyphicon-check\\\" ng-show=\\\"Main.isFilterSelected(filterValue)\\\"></i></td><td>{{ ::filterValue }}</td><td></td></tr></tbody></table></div><div class=\\\"col-md-4\\\" style=\\\"margin-bottom: 2em;\\\"><form name=\\\"csvForm\\\" ng-submit=\\\"Main.renderHeatmap(csvForm)\\\"><div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': csvForm.$submitted && csvForm.csv.$invalid}\\\"><label class=\\\"control-label\\\" for=\\\"csv\\\">CSV File</label> <input ng-model=\\\"Main.csvRows\\\" type=\\\"file\\\" name=\\\"csv\\\" ng-change=\\\"Main.csvChanged()\\\" csv-reader=\\\"\\\" id=\\\"csv\\\"><div ng-messages=\\\"csvForm.csv.$error\\\" ng-show=\\\"csvForm.$submitted\\\"><div ng-messages-include=\\\"error-messages\\\"></div></div></div><div class=\\\"form-group\\\"><label class=\\\"control-label\\\" for=\\\"intensity\\\">Point intensity (%)</label> <input type=\\\"number\\\" name=\\\"intensity\\\" min=\\\"0\\\" max=\\\"100\\\" ng-model=\\\"Main.pointIntensity\\\" class=\\\"form-control\\\" id=\\\"intensity\\\"></div><div class=\\\"form-group\\\"><label class=\\\"control-label\\\" for=\\\"radius\\\">Point radius (meters)</label> <input name=\\\"radius\\\" type=\\\"number\\\" min=\\\"0\\\" max=\\\"10000\\\" ng-model=\\\"Main.heatmapOptions.size\\\" class=\\\"form-control\\\" id=\\\"radius\\\"></div><div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': csvForm.$submitted && csvForm.latitudeColumn.$invalid}\\\"><label class=\\\"control-label\\\" for=\\\"latitudeColumn\\\">Latitude column</label><select name=\\\"latitudeColumn\\\" class=\\\"form-control\\\" ng-model=\\\"Main.latitudeColumn\\\" required=\\\"\\\" id=\\\"latitudeColumn\\\"><option ng-repeat=\\\"headerName in Main.header\\\">{{ headerName }}</option></select><div ng-messages=\\\"csvForm.latitudeColumn.$error\\\" ng-show=\\\"csvForm.$submitted\\\"><div ng-messages-include=\\\"error-messages\\\"></div></div></div><div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': csvForm.$submitted && csvForm.longitudeColumn.$invalid}\\\"><label class=\\\"control-label\\\" for=\\\"longitudeColumn\\\">Longitude column</label><select name=\\\"longitudeColumn\\\" class=\\\"form-control\\\" ng-model=\\\"Main.longitudeColumn\\\" required=\\\"\\\" id=\\\"longitudeColumn\\\"><option ng-repeat=\\\"headerName in Main.header\\\">{{ headerName }}</option></select><div ng-messages=\\\"csvForm.longitudeColumn.$error\\\" ng-show=\\\"csvForm.$submitted\\\"><div ng-messages-include=\\\"error-messages\\\"></div></div></div><div class=\\\"form-group\\\"><label class=\\\"control-label\\\" for=\\\"filterByColumn\\\">Filter by column (optional)</label><select name=\\\"filterByColumn\\\" class=\\\"form-control\\\" ng-model=\\\"Main.filterByColumn\\\" id=\\\"filterByColumn\\\" ng-change=\\\"Main.filterByColumnChanged()\\\"><option ng-repeat=\\\"headerName in Main.header\\\">{{ headerName }}</option></select></div><button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Render heatmap</button></form></div></div>\");\n$templateCache.put(\"app/components/csv-reader/csv-reader.html\",\"<input type=\\\"file\\\" name=\\\"csv\\\">\");}]);"],"sourceRoot":"/source/"}